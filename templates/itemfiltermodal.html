<!-- Item Filter Modal -->
<div id="itemFilterModal" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center z-50">
  <div class="bg-white p-6 rounded-2xl w-full max-w-md shadow-2xl overflow-y-auto max-h-[90vh] border border-gray-200">
    <h3 class="text-xl font-semibold text-blue-600 mb-4 flex items-center gap-2">
      <i data-lucide="filter"></i>
      <span>Filter Devices</span>
    </h3>

    <form id="itemFilterForm" class="space-y-4">
      <!-- Device Name -->
      <div>
        <label class="block text-gray-700 font-medium mb-1">Device Name</label>
        <input type="text" id="filter_item_name" placeholder="Device Name"
          class="w-full p-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 text-black">
      </div>

      <!-- Brand / Model -->
      <div>
        <label class="block text-gray-700 font-medium mb-1">Brand / Model</label>
        <input type="text" id="filter_brand_model" placeholder="Brand / Model"
          class="w-full p-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 text-black">
      </div>

      <!-- Department -->
      <div>
        <label class="block text-gray-700 font-medium mb-1">Department</label>
        <select id="filter_department_id"
          class="w-full p-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 text-black">
          <option value="">All Departments</option>
        </select>
      </div>

      <!-- Status -->
      <div>
        <label class="block text-gray-700 font-medium mb-1">Status</label>
        <select id="filter_status"
          class="w-full p-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 text-black">
          <option value="">All Status</option>
          <option value="Available">Available</option>
          <option value="In Used">In Used</option>
          <option value="Inactive">Inactive</option>
          <option value="Damaged">Damaged</option>
        </select>
      </div>

      <!-- Buttons -->
      <div class="flex justify-end gap-3 mt-6">
        <button type="button" onclick="closeItemFilterModal()"
          class="px-4 py-2 bg-gray-400 hover:bg-gray-500 text-white rounded-lg text-sm">
          Cancel
        </button>
        <button type="button" onclick="applyItemFilter()"
          class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm">
          Apply Filter
        </button>
      </div>
    </form>
  </div>
</div>

<script>
async function openItemFilterModal() {
  const modal = document.getElementById('itemFilterModal');
  const deptSelect = document.getElementById('filter_department_id');

  // Load departments dynamically
  try {
    const res = await fetch('manage_inventory/get-departments');
    const departments = await res.json();
    deptSelect.innerHTML = '<option value="">All Departments</option>';
    departments.forEach(dep => {
      const opt = document.createElement('option');
      opt.value = dep.department_id;
      opt.textContent = dep.department_name;
      deptSelect.appendChild(opt);
    });
  } catch {
    deptSelect.innerHTML = '<option value="">Error loading departments</option>';
  }

  lucide.createIcons();
  modal.classList.remove('hidden');
}

function closeItemFilterModal() {
  document.getElementById('itemFilterModal').classList.add('hidden');
}

// Example filter function
function applyItemFilter() {
  const name = document.getElementById('filter_item_name').value.toLowerCase();
  const brand = document.getElementById('filter_brand_model').value.toLowerCase();
  const dept = document.getElementById('filter_department_id').value;
  const status = document.getElementById('filter_status').value;

  document.querySelectorAll('#itemsSection tbody tr').forEach(row => {
    const rowName = row.children[2].textContent.toLowerCase();      // item_name
    const rowBrand = row.children[3].textContent.toLowerCase();     // brand_model
    const rowDept = row.children[11].textContent;                   // department_id
    const rowStatus = row.children[12].textContent;                 // status

    const show = 
      (name === '' || rowName.includes(name)) &&
      (brand === '' || rowBrand.includes(brand)) &&
      (dept === '' || rowDept === dept) &&
      (status === '' || rowStatus === status);

    row.style.display = show ? '' : 'none';
  });

  closeItemFilterModal();
}
</script>
