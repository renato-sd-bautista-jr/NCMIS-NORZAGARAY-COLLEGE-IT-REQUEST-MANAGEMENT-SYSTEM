<div id="pcModal" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center z-50">
  <div class="bg-white p-6 rounded-2xl w-full max-w-lg shadow-2xl overflow-y-auto max-h-[90vh]">
    <h3 id="modalTitle" class="text-xl font-semibold text-blue-600 mb-4">Add PC</h3>

    <form id="pcForm" method="post" class="space-y-4">

      <input type="hidden" id="modalPcId" name="pcid">

      <!-- Basic PC Info -->
      <div>
        <label class="block text-gray-700 font-medium mb-1">PC Name</label>
        <input type="text" id="modalPcName" name="pcname" required class="w-full p-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500">
      </div>

      <div>
        <label class="block text-gray-700 font-medium mb-1">Department</label>
        <select id="modalDepartment" name="department_id" required class="w-full p-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500">
          <option value="">Select Department</option>
          {% for dep in departments %}
            <option value="{{ dep.department_id }}">{{ dep.department_name }}</option>
          {% endfor %}
        </select>
      </div>

      <div>
        <label class="block text-gray-700 font-medium mb-1">Status</label>
        <select id="modalStatus" name="status" class="w-full p-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500">
          <option value="Active">Active</option>
          <option value="Inactive">Inactive</option>
        </select>
      </div>

      <div>
        <label class="block text-gray-700 font-medium mb-1">Note</label>
        <textarea id="modalNote" name="note" rows="2" class="w-full p-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500"></textarea>
      </div>

      <!-- PC Parts Section -->
      <div id="partsSection" class="mt-4">
        <h4 class="text-lg font-semibold text-blue-600 mb-2">PC Parts</h4>
        <div class="grid grid-cols-1 gap-2">
          {% for part in ['Monitor', 'Motherboard', 'RAM', 'Storage', 'GPU', 'PSU', 'Casing', 'Other Parts'] %}
          <div>
            <label class="block text-gray-700 font-medium mb-1">{{ part }}</label>
            <input type="text" id="{{ part|lower|replace(' ', '_') }}" name="{{ part|lower|replace(' ', '_') }}"
              class="w-full p-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500">
          </div>
          {% endfor %}
        </div>
      </div>

      <!-- Batch Add -->
      <div id="batchAddSection" class="hidden mt-4">
        <label class="block text-gray-700 font-medium mb-1">Number of identical PCs to add</label>
        <input type="number" id="batchCount" name="batch_count" value="1" min="1"
          class="w-full p-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500">
      </div>

      <!-- Buttons -->
      <div class="flex justify-end gap-3 mt-6">
        <button type="button" onclick="closePcModal()" class="px-4 py-2 bg-gray-400 hover:bg-gray-500 text-white rounded-lg text-sm">Cancel</button>
        <button id="modalSubmitBtn" type="submit" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm">Add PC</button>
      </div>
    </form>
  </div>
</div>

<script>
function openPcModal(pcData = null) {
  const modal = document.getElementById('pcModal');
  const title = document.getElementById('modalTitle');
  const form = document.getElementById('pcForm');
  const submitBtn = document.getElementById('modalSubmitBtn');
  const batchSection = document.getElementById('batchAddSection');
  const deptSelect = document.getElementById('modalDepartment');

  form.reset();

  if (pcData) {
    // --- EDIT MODE ---
    title.textContent = "Edit PC";
    form.action = "{{ url_for('manage_pc_bp.update_pc_with_parts') }}";
    submitBtn.textContent = "Update PC";
    batchSection.classList.add('hidden');

    document.getElementById('modalPcId').value = pcData.pcid || '';
    document.getElementById('modalPcName').value = pcData.pcname || '';
    document.getElementById('modalStatus').value = pcData.status || 'Active';
    document.getElementById('modalNote').value = pcData.note || '';

    if (pcData.department_id) {
      [...deptSelect.options].forEach(opt => opt.selected = (String(opt.value) === String(pcData.department_id)));
    }

    const fields = ['monitor','motherboard','ram','storage','gpu','psu','casing','other_parts'];
    fields.forEach(f => {
      document.getElementById(f).value = pcData[f] || '';
    });

  } else {
    // --- ADD MODE ---
    title.textContent = "Add New PC";
    form.action = "{{ url_for('manage_pc_bp.add_pc_route') }}";
    submitBtn.textContent = "Add PC";
    batchSection.classList.remove('hidden');
    deptSelect.selectedIndex = 0;
  }

  modal.classList.remove('hidden');
}

function closePcModal() {
  document.getElementById('pcModal').classList.add('hidden');
}
</script>
