<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Inventory & Manage Items</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body class="flex min-h-screen bg-gray-100 text-gray-800">

  {% include 'sidebar.html' %}
  {% include 'delete_modal.html' %}
  {% include 'partials/filter_device_modal.html' %}
  <!-- Overlay for mobile -->
  <div id="sidebarOverlay" class="hidden fixed inset-0 bg-black/50 z-40"></div>

  <!-- MAIN CONTENT -->
  <main class="flex-1 ml-0 md:ml-64 transition-all duration-300 p-6">   

    <!-- NAVBAR now INSIDE main content -->
    <div class="bg-gradient-to-r from-blue-600 to-blue-500 text-white rounded-xl shadow-lg p-4 mb-6 flex items-center justify-between">
      <button id="sidebarToggle" class="md:hidden text-white hover:text-gray-200">
        <i data-lucide="menu" class="w-6 h-6"></i>
      </button>
      <h2 class="text-2xl font-bold flex items-center gap-2">
        <i data-lucide="layout-dashboard" class="w-7 h-7"></i> Inventory & Item Management
      </h2>

        <div class="flex items-center gap-2">
          {% include 'pceditmodal.html' %}
          {% include 'itemeditmodal.html' %}
        </div>

      <div class="w-6"></div>
    </div>

    <!-- NAVIGATION BUTTONS -->
    <nav class="flex flex-col md:flex-row gap-3 px-4 py-3 mb-4 bg-white rounded-xl shadow-sm border border-gray-200">
      <button onclick="showSection('inventorySection'); setActiveNav(this)"
        class="flex items-center px-5 py-3 rounded-lg font-medium text-gray-700 bg-blue-50 text-blue-700 border border-blue-300 shadow-sm transition-all duration-200"
        id="inventoryBtn">
        <i data-lucide="cpu" class="w-5 h-5 mr-2 text-blue-600"></i>
        Manage PC
      </button>

      <button onclick="showSection('itemsSection'); setActiveNav(this)"
        class="flex items-center px-5 py-3 rounded-lg font-medium text-gray-700 bg-white hover:bg-blue-50 hover:text-blue-700 hover:border-blue-300 border border-gray-200 shadow-sm transition-all duration-200"
        id="itemsBtn">
        <i data-lucide="package" class="w-5 h-5 mr-2 text-blue-600"></i>
        Manage Devices
      </button>
    </nav>

    <!-- PAGE CONTENT BELOW NAVBAR -->
    <div class="space-y-8">
      <!-- ACTION BAR -->
<div class="flex justify-end mb-4">
  
  
    {% if permissions.get('inventory', {}).get('edit', False) %}
    <button 
    id="addButton"
    onclick="handleAddButtonClick()" 
    class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg shadow transition">
    Add PC
  </button>
  
  {% endif %}
</div>

      <!-- INVENTORY SECTION -->
      <section id="inventorySection">

        <!-- MANAGE PC SECTION -->
        <div class="bg-white rounded-xl shadow-lg p-6">
          <h3 class="text-xl font-bold text-blue-600 mb-4 flex items-center gap-2">
            <i data-lucide="cpu" class="w-6 h-6"></i> Manage PC
          </h3>
          <button 
  type="button"
  class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center gap-2"
  onclick="openPcFilterModal()">
  <i data-lucide="filter"></i> Filter PCs
</button>
<button 
  type="button"
  class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center gap-2"
  onclick="runRiskUpdate()">
  <i data-lucide="refresh-cw"></i> Update Risk Levels
</button>


        
          

          {% if pc_list|length == 0 %}
          <div class="bg-gray-100 text-gray-600 p-4 rounded-lg text-center">No PCs found.</div>
          {% else %}
          <div class="overflow-x-auto rounded-xl">
            <table class="min-w-full border border-gray-200 text-sm text-gray-800">
              <thead class="bg-gray-200 text-gray-700">

                
<button
  onclick="bulkMarkPcChecked()"
  class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg flex items-center gap-2">
  <i data-lucide="check-square"></i>
  Mark Selected Checked
</button>
                <tr>
                  <th class="px-4 py-2 border-b text-left">
<input
  type="checkbox"
  id="selectAllPcs"
  onclick="toggleSelectAllPCs(this)">
</th>
                  <th class="px-4 py-2 border-b text-left">PC ID</th>
                  <th class="px-4 py-2 border-b text-left">PC Name</th>
                  <th class="px-4 py-2 border-b text-left">Department</th>
                  <th class="px-4 py-2 border-b text-left">Location</th>
                  <th class="px-4 py-2 border-b text-left">Acquisition_Cost</th>
                  <th class="px-4 py-2 border-b text-left">Date Acquired</th>
                  <th class="px-4 py-2 border-b text-left">Accountable</th>
                  <th class="px-4 py-2 border-b text-left">Serial No.</th>
                  <th class="px-4 py-2 border-b text-left">Municipal Serial No.</th> 
                  <th class="px-4 py-2 border-b text-left">Status</th>
                  {% if permissions.get('inventory', {}).get('edit', False) %}
                  <th class="px-4 py-2 border-b text-left">Risk</th>
                  <th class="px-4 py-2 border-b text-left">Health</th>
                  <th class="px-4 py-2 border-b text-left">Actions</th>
                  {% endif %}
                </tr>
              </thead>
               
                <tbody id="pcTableBody">
                {% for pc in pc_list %}
                <tr class="hover:bg-gray-100 transition">
                  <td class="px-4 py-2 border-b">
  <input type="checkbox"
         class="pc-checkbox"
         value="{{ pc.pcid }}">
</td>
                  <td class="px-4 py-2 border-b">{{ pc.pcid }}</td>
                  <td class="px-4 py-2 border-b">{{ pc.pcname }}</td>
                  <td class="px-4 py-2 border-b">{{ pc.department_name }}</td>
                  <td class="px-4 py-2 border-b">{{ pc.location }}</td>
                  <td class="px-4 py-2 border-b">{{ pc.acquisition_cost }}</td>
                  <td class="px-4 py-2 border-b">{{ pc.date_acquired }}</td>
                  <td class="px-4 py-2 border-b">{{ pc.accountable }}</td>
                  <td class="px-4 py-2 border-b">{{ pc.serial_no }}</td>
                  <td class="px-4 py-2 border-b">{{ pc.municipal_serial_no }}</td>   
  <!-- STATUS -->
  <td class="px-4 py-2 border-b font-medium
      {% if pc.status == 'Available' %}text-green-600
      {% elif pc.status == 'In Used' %}text-blue-600
      {% elif pc.status == 'Inactive' %}text-gray-500
      {% else %}text-red-600{% endif %}">
    {{ pc.status }}
  </td>
   <!-- RISK -->
            <td class="px-4 py-2 border-b">
              <span class="
                {% if pc.risk_level == 'High' %}text-red-600
                {% elif pc.risk_level == 'Medium' %}text-yellow-600
                {% elif pc.risk_level == 'Low' %}text-green-600
                {% else %}text-gray-500
                {% endif %}
                font-semibold">
                {{ pc.risk_level or '—' }}
              </span>
            </td>
   <!-- HEALTH SCORE -->
  <td class="px-4 py-2 border-b">
    {% if pc.health_score is not none %}
      <div class="flex items-center gap-2">
        <div class="w-24 bg-gray-200 rounded-full h-2">
          <div
            class="h-2 rounded-full
            {% if pc.health_score >= 80 %}bg-green-500
            {% elif pc.health_score >= 50 %}bg-yellow-500
            {% else %}bg-red-500{% endif %}"
            style="width: {{ pc.health_score }}%">
          </div>
        </div>
        <span class="text-xs font-semibold">{{ pc.health_score or 0 }}%</span>
      </div>
    {% else %}
      —
    {% endif %}
  </td>
 
     <!-- ACTIONS -->
{% if permissions.get('inventory', {}).get('edit', False) %}
  <td class="px-4 py-2 border-b flex gap-2">
    <button
      onclick="openPcModalById({{ pc.pcid }})"
      class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded text-xs shadow">
      Edit
    </button>

    <button
      type="button"
      onclick="openDeleteModal('{{ url_for('manage_pc_bp.delete_pc', pcid=pc.pcid) }}')"
      class="bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded text-xs shadow">
      Delete
    </button>
 {% if pc.status == 'Needs Checking' or pc.risk_level != 'Low' %}
    <button
      onclick="markPcChecked({{ pc.pcid }})"
      class="bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded text-xs shadow">
      Mark Checked
    </button>
    {% endif %}
    <button
    onclick="openMaintenanceLog({{ pc.pcid }}, 'PC')"
    class="bg-gray-600 hover:bg-gray-700 text-white px-3 py-1 rounded text-xs shadow">
    History
</button>
  </td>
            {% endif %}
          </tr>
          {% endfor %}
        </tbody>
      </table>
          <!-- PAGINATION -->
      <div class="flex items-center justify-between mt-4 text-sm">
        <div class="text-gray-600">
          Showing page {{ page }} of {{ total_pages }} ({{ total_items }} total records)
        </div>

        <div class="flex gap-1">
          {% if page > 1 %}
            <a href="?page={{ page - 1 }}&per_page={{ per_page }}&section=pc"
               class="px-3 py-1 border rounded hover:bg-gray-100">
              Previous
            </a>
          {% endif %}

          {% for p in range(1, total_pages + 1) %}
            <a href="?page={{ p }}&per_page={{ per_page }}&section=pc"
               class="px-3 py-1 border rounded
               {% if p == page %}
                 bg-blue-600 text-white border-blue-600
               {% else %}
                 hover:bg-gray-100
               {% endif %}">
              {{ p }}
            </a>
          {% endfor %}

          {% if page < total_pages %}
            <a href="?page={{ page + 1 }}&per_page={{ per_page }}&section=pc"
               class="px-3 py-1 border rounded hover:bg-gray-100">
              Next
            </a>
          {% endif %}
        </div>
      </div>

      <!-- ROWS PER PAGE -->
      <form method="get" class="flex items-center gap-2 mt-2">
        <input type="hidden" name="section" value="pc">
        <label class="text-sm">Rows:</label>
        <select name="per_page"
                onchange="this.form.submit()"
                class="border rounded px-2 py-1">
          {% for size in [5, 10, 25, 50] %}
            <option value="{{ size }}" {% if per_page == size %}selected{% endif %}>
              {{ size }}
            </option>
          {% endfor %}
        </select>
      </form>

    </div>
    {% endif %}
  </div>

        
      </section>

      <!-- MANAGE DEVICES SECTION -->
<section id="itemsSection" class="hidden">
  <div class="bg-white rounded-xl shadow-lg p-6">
    <h3 class="text-xl font-bold text-blue-600 mb-4 flex items-center gap-2">
      <i data-lucide="package" class="w-6 h-6"></i> Manage Devices
    </h3>
<button 
  type="button"
  class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center gap-2"
  onclick="openDeviceFilterModalFromFile()">
  <i data-lucide="filter"></i> Filter Devices
</button>
    {% if item_list|length == 0 %}
    <div class="bg-gray-100 text-gray-600 p-4 rounded-lg text-center">No devices found.</div>
    {% else %}
    <div class="overflow-x-auto rounded-xl">
      <table class="min-w-full border border-gray-200 text-sm text-gray-800">
        <thead class="bg-gray-200 text-gray-700">
          <tr>
            <th class="px-4 py-2 border-b text-left">
  <input type="checkbox" id="selectAllDevices" onclick="toggleSelectAllDevices()">
</th>
            <th class="px-4 py-2 border-b text-left">ID</th>
            <th class="px-4 py-2 border-b text-left">Device Name</th>
            <th class="px-4 py-2 border-b text-left">Brand / Model</th>
            <th class="px-4 py-2 border-b text-left">Serial No</th>
            <th class="px-4 py-2 border-b text-left">Municipal Serial No</th>
            <th class="px-4 py-2 border-b text-left">Acquisition Cost</th>
            <th class="px-4 py-2 border-b text-left">Date Acquired</th>
            <th class="px-4 py-2 border-b text-left">Accountable</th>
            <th class="px-4 py-2 border-b text-left">Department</th>
            <th class="px-4 py-2 border-b text-left">Status</th>
            <th class="px-4 py-2 border-b text-left">Risk</th>
            <th class="px-4 py-2 border-b text-left">Health</th>
            <th class="px-4 py-2 border-b text-left">Actions</th>
          </tr>
        </thead>
        <div class="flex flex-wrap gap-3 mb-4">
  <select id="bulkDeviceStatus"
          class="border rounded px-3 py-2 text-sm">
    <option value="">Select Status</option>
    <option value="Available">Available</option>
    <option value="In Used">In Used</option>
    <option value="Needs Checking">Needs Checking</option>
    <option value="Damaged">Damaged</option>
    <option value="Inactive">Inactive</option>
  </select>

  <button
    onclick="bulkUpdateDevices()"
    class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg flex items-center gap-2">
    <i data-lucide="check-square"></i>
    Apply to Selected
  </button>
</div>
        <tbody id="deviceTableBody">
          {% for item in item_list %}
          <tr class="hover:bg-gray-100 transition">
            <td class="px-4 py-2 border-b">
  <input type="checkbox"
         class="device-checkbox"
         value="{{ item.accession_id }}">
</td>
  <td class="px-4 py-2 border-b">{{ item.accession_id }}</td>
  <td class="px-4 py-2 border-b">{{ item.item_name }}</td>
  <td class="px-4 py-2 border-b">{{ item.brand_model or '—' }}</td>
  <td class="px-4 py-2 border-b">{{ item.serial_no or '—' }}</td>
  <td class="px-4 py-2 border-b">{{ item.municipal_serial_no or '—' }}</td>
  <td class="px-4 py-2 border-b">₱{{ '%.2f'|format(item.acquisition_cost or 0) }}</td>
  <td class="px-4 py-2 border-b">{{ item.date_acquired or '—' }}</td>
  <td class="px-4 py-2 border-b">{{ item.accountable or '—' }}</td>
  <td class="px-4 py-2 border-b">{{ item.department_name or '—' }}</td>

  <!-- STATUS -->
  <td class="px-4 py-2 border-b font-medium
      {% if item.status == 'Available' %}text-green-600
      {% elif item.status == 'In Used' %}text-blue-600
      {% elif item.status == 'Inactive' %}text-gray-500
      {% else %}text-red-600{% endif %}">
    {{ item.status }}
  </td>

  <!-- RISK LEVEL -->
  <td class="px-4 py-2 border-b font-semibold
      {% if item.risk_level == 'Low' %}text-green-600
      {% elif item.risk_level == 'Medium' %}text-yellow-600
      {% elif item.risk_level == 'High' %}text-red-600
      {% else %}text-gray-500{% endif %}">
    {{ item.risk_level or '—' }}
  </td>

  <!-- HEALTH SCORE -->
  <td class="px-4 py-2 border-b">
    {% if item.health_score is not none %}
      <div class="flex items-center gap-2">
        <div class="w-24 bg-gray-200 rounded-full h-2">
          <div
            class="h-2 rounded-full
            {% if item.health_score >= 80 %}bg-green-500
            {% elif item.health_score >= 50 %}bg-yellow-500
            {% else %}bg-red-500{% endif %}"
            style="width: {{ item.health_score }}%">
          </div>
        </div>
        <span class="text-xs font-semibold">{{ item.health_score }}%</span>
      </div>
    {% else %}
      —
    {% endif %}
  </td>

  <!-- ACTIONS -->
  {% if permissions.get('inventory', {}).get('edit', False) %}
  <td class="px-4 py-2 border-b flex gap-2">
    <button
      onclick="openItemModalById({{ item.accession_id }})"
      class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded text-xs shadow">
      Edit
    </button>

    <button
      type="button"
      onclick="openDeleteModal('{{ url_for('manage_item_bp.delete_item', id=item.accession_id) }}')"
      class="bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded text-xs shadow">
      Delete
    </button>

    <button
      onclick="markChecked('DEVICE', {{ item.accession_id }})"
      class="bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded text-xs shadow">
      Mark Checked
    </button>
    <button
    onclick="openMaintenanceLog({{ item.accession_id }}, 'DEVICE')"
    class="bg-gray-600 hover:bg-gray-700 text-white px-3 py-1 rounded text-xs shadow">
    History
</button>
  </td>
  {% endif %}
</tr>
          {% endfor %}
        </tbody>
      </table>  
      <!-- PAGINATION -->
<div class="flex items-center justify-between mt-4 text-sm">
  <div class="text-gray-600">
    Showing page {{ page }} of {{ total_pages }} ({{ total_items }} total records)
  </div>

  <div class="flex gap-1">
    {% if page > 1 %}
      <a href="?page={{ page - 1 }}&per_page={{ per_page }}"
         class="px-3 py-1 border rounded hover:bg-gray-100">
        Previous
      </a>
    {% endif %}

    {% for p in range(1, total_pages + 1) %}
      <a href="?page={{ p }}&per_page={{ per_page }}&section=items"
         class="px-3 py-1 border rounded
         {% if p == page %}
           bg-blue-600 text-white border-blue-600
         {% else %}
           hover:bg-gray-100
         {% endif %}">
        {{ p }}
      </a>
    {% endfor %}

    {% if page < total_pages %}
      <a href="?page={{ page + 1 }}&per_page={{ per_page }}"
         class="px-3 py-1 border rounded hover:bg-gray-100">
        Next
      </a>
    {% endif %}
  </div>
</div>
<form method="get" class="flex items-center gap-2">
  <input type="hidden" name="section" value="items">
  <label class="text-sm">Rows:</label>
  <select name="per_page"
          onchange="this.form.submit()"
          class="border rounded px-2 py-1">
    {% for size in [5, 10, 25, 50] %}
      <option value="{{ size }}" {% if per_page == size %}selected{% endif %}>
        {{ size }}
      </option>
    {% endfor %}
  </select>
</form>

    </div>
    {% endif %}
  </div>
</section>


    </div>
  </main>

  <!-- LOGOUT MODAL -->
  <div id="logoutModal" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center z-50">
    <div class="bg-white rounded-2xl shadow-2xl p-6 w-96 text-center">
      <i data-lucide="alert-triangle" class="w-12 h-12 text-yellow-500 mx-auto mb-3"></i>
      <h2 class="text-lg font-semibold text-blue-600 mb-2">Confirm Logout</h2>
      <p class="text-gray-600 mb-6">Are you sure you want to log out?</p>
      <div class="flex justify-center space-x-3">
        <button id="cancelLogout" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg">Cancel</button>
        <form method="post" action="{{ url_for('login_bp.logout') }}">
          <button type="submit" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg">Logout</button>
        </form>
      </div>
    </div>
  </div>

  <script>
 
 
 
lucide.createIcons();

  </script>

<!-- PC Logic -->
<script src="{{ url_for('static', filename='js/manage_pc.js') }}"></script>
<script src="{{ url_for('static', filename='js/pc_filter.js') }}"></script>

<!-- Device Logic -->
<script src="{{ url_for('static', filename='js/manage_device.js') }}"></script>
<script src="{{ url_for('static', filename='js/filter_device_modal.js') }}"></script>


</body>
</html>
