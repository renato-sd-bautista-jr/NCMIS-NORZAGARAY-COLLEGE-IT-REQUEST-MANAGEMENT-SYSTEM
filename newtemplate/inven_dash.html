<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Inventory Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest"></script>
</head>

<body class="flex min-h-screen bg-gray-200 text-gray-800">

  <!-- Sidebar -->
  <aside id="sidebar"
    class="fixed top-0 left-0 h-full w-64 bg-[#1E293B] text-gray-100 flex flex-col justify-between shadow-xl z-50 transform transition-transform duration-300 md:translate-x-0 -translate-x-full">

    <!-- Logo -->
    <div>
      <div class="mb-8 text-center border-b border-blue-500 pb-5 mt-4">
        <h4 class="text-3xl font-extrabold tracking-wide text-white">NCMIS</h4>
        <span class="text-blue-300 text-sm">Inventory Dashboard</span>
      </div>

      <!-- Navigation -->
      <nav class="flex flex-col gap-2 px-4">
        <!-- Dashboard -->
        <a href="{{ url_for('invendash_bp.dashboard_page') }}"
           class="flex items-center px-4 py-3 rounded-lg font-medium text-gray-200 transition-all duration-200
                  {% if request.endpoint == 'invendash_bp.dashboard_page' %}
                    bg-blue-600 text-white shadow-md
                  {% else %}
                    hover:bg-blue-600/30 hover:text-white
                  {% endif %}">
          <i data-lucide="layout-dashboard" class="w-5 h-5 mr-3"></i> Dashboard
        </a>

        <!-- Manage Items -->
        <a href="{{ url_for('manage_item') }}"
           class="flex items-center px-4 py-3 rounded-lg font-medium text-gray-200 transition-all duration-200
                  {% if request.endpoint == 'manage_item' %}
                    bg-blue-600 text-white shadow-md
                  {% else %}
                    hover:bg-blue-600/30 hover:text-white
                  {% endif %}">
          <i data-lucide="package" class="w-5 h-5 mr-3"></i> Manage Items
        </a>

        <!-- Inventory -->
        <a href="{{ url_for('inventory') }}"
           class="flex items-center px-4 py-3 rounded-lg font-medium text-gray-200 transition-all duration-200 hover:bg-blue-600/30 hover:text-white">
          <i data-lucide="cpu" class="w-5 h-5 mr-3"></i> Inventory
        </a>

        <!-- QR List -->
        <a href="{{ url_for('qrcode_bp.qrcode_generator_page') }}"
           class="flex items-center px-4 py-3 rounded-lg font-medium text-gray-200 transition-all duration-200 hover:bg-blue-600/30 hover:text-white">
          <i data-lucide="qr-code" class="w-5 h-5 mr-3"></i> QR List
        </a>

        <!-- Report -->
        <a href="{{ url_for('report_bp.report_generator_page') }}"
           class="flex items-center px-4 py-3 rounded-lg font-medium text-gray-200 transition-all duration-200 hover:bg-blue-600/30 hover:text-white">
          <i data-lucide="bar-chart-3" class="w-5 h-5 mr-3"></i> Report
        </a>
      </nav>
    </div>

    <!-- Logout Button -->
    <div class="p-4">
      <button id="logoutBtn"
        class="flex items-center justify-center w-full px-4 py-3 rounded-lg bg-red-600 hover:bg-red-700 transition font-semibold shadow-md">
        <i data-lucide="log-out" class="w-5 h-5 mr-2"></i> Logout
      </button>
    </div>
  </aside>

  <!-- Overlay for mobile -->
  <div id="overlay" class="fixed inset-0 bg-black/40 hidden z-40 md:hidden"></div>

  <!-- Main Content -->
  <main class="flex-1 ml-0 md:ml-64 p-8 transition-all duration-300 space-y-8">

    <!-- Mobile Menu Button -->
    <button id="sidebarToggle" class="md:hidden flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg shadow">
      <i data-lucide="menu" class="w-5 h-5"></i> Menu
    </button>

    <!-- Header -->
    <div class="flex items-center gap-3">
      <i data-lucide="layout-dashboard" class="w-8 h-8 text-blue-600"></i>
      <h2 class="text-3xl font-bold text-gray-900">Inventory Dashboard</h2>
    </div>

    <!-- Stats Cards -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
      <div class="bg-white rounded-2xl shadow p-6 flex items-center justify-between border hover:scale-[1.02] transition">
        <div>
          <h3 class="text-sm font-semibold text-gray-500">Total Items</h3>
          <p class="text-3xl font-bold text-gray-900 mt-2">{{ total_items }}</p>
        </div>
        <i data-lucide="box" class="w-10 h-10 text-blue-600"></i>
      </div>
      <div class="bg-white rounded-2xl shadow p-6 flex items-center justify-between border hover:scale-[1.02] transition">
        <div>
          <h3 class="text-sm font-semibold text-gray-500">Available</h3>
          <p class="text-3xl font-bold text-green-600 mt-2">{{ available_items }}</p>
        </div>
        <i data-lucide="check-circle" class="w-10 h-10 text-green-600"></i>
      </div>
      <div class="bg-white rounded-2xl shadow p-6 flex items-center justify-between border hover:scale-[1.02] transition">
        <div>
          <h3 class="text-sm font-semibold text-gray-500">Borrowed</h3>
          <p class="text-3xl font-bold text-yellow-600 mt-2">{{ borrowed_items }}</p>
        </div>
        <i data-lucide="clipboard-check" class="w-10 h-10 text-yellow-600"></i>
      </div>
      <div class="bg-white rounded-2xl shadow p-6 flex items-center justify-between border hover:scale-[1.02] transition">
        <div>
          <h3 class="text-sm font-semibold text-gray-500">Damaged</h3>
          <p class="text-3xl font-bold text-red-600 mt-2">{{ damaged_items }}</p>
        </div>
        <i data-lucide="alert-triangle" class="w-10 h-10 text-red-600"></i>
      </div>
    </div>

    <!-- Notifications -->
    <section>
      <h3 class="text-xl font-bold text-blue-700 mb-3">Notifications</h3>
      <div class="bg-white rounded-2xl shadow p-6 border space-y-3">
        {% if low_stock_items %}
        <div class="flex items-center gap-3 p-3 rounded-lg border-l-4 border-yellow-500 bg-yellow-50">
          <i data-lucide="alert-circle" class="w-5 h-5 text-yellow-600"></i>
          <span>⚠ Low stock: {{ low_stock_items }} items running low.</span>
        </div>
        {% endif %}
        {% if overdue_items %}
        <div class="flex items-center gap-3 p-3 rounded-lg border-l-4 border-red-600 bg-red-50">
          <i data-lucide="clock" class="w-5 h-5 text-red-600"></i>
          <span>⏰ {{ overdue_items }} items are overdue for return.</span>
        </div>
        {% endif %}
        {% if recent_added_items %}
        <div class="flex items-center gap-3 p-3 rounded-lg border-l-4 border-green-500 bg-green-50">
          <i data-lucide="plus-circle" class="w-5 h-5 text-green-600"></i>
          <span>✅ {{ recent_added_items }} items were recently added.</span>
        </div>
        {% endif %}
        {% if not low_stock_items and not overdue_items and not recent_added_items %}
        <p class="text-gray-500">No new notifications.</p>
        {% endif %}
      </div>
    </section>

    <!-- Inventory Table -->
    <section>
      <div class="flex flex-col md:flex-row justify-between items-center gap-4 mb-4">
        <div class="relative w-full md:w-1/2">
          <i data-lucide="search" class="absolute left-3 top-2.5 text-gray-400 w-5 h-5"></i>
          <input id="searchInput" type="text" placeholder="Search..."
                 class="w-full border border-gray-300 rounded-xl pl-10 pr-4 py-2 bg-white text-gray-900 focus:ring-2 focus:ring-blue-500 focus:outline-none">
        </div>
        <select id="statusFilter"
                class="w-full md:w-48 border border-gray-300 rounded-xl px-4 py-2 bg-white text-gray-900 focus:ring-2 focus:ring-blue-500 focus:outline-none">
          <option value="all">All Status</option>
          <option value="Available">Available</option>
          <option value="Borrowed">Borrowed</option>
          <option value="Damaged">Damaged</option>
        </select>
      </div>

      <div class="overflow-x-auto rounded-xl shadow border">
        <table id="inventoryTable" class="min-w-full text-sm text-gray-900">
          <thead class="bg-blue-600 text-white">
            <tr>
              <th class="px-4 py-3 text-left">Item Name</th>
              <th class="px-4 py-3 text-left">Brand / Model</th>
              <th class="px-4 py-3 text-left">Serial</th>
              <th class="px-4 py-3 text-left">Status</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-gray-200">
            {% for u in units %}
            <tr class="hover:bg-blue-50 transition">
              <td class="px-4 py-3">{{ u.item_name }}</td>
              <td class="px-4 py-3">{{ u.brand_model }}</td>
              <td class="px-4 py-3">{{ u.unit_serial }}</td>
              <td class="px-4 py-3">
                {% if u.status == 'Available' %}
                  <span class="px-2 py-1 rounded-lg text-xs bg-green-100 text-green-700">Available</span>
                {% elif u.status == 'Borrowed' %}
                  <span class="px-2 py-1 rounded-lg text-xs bg-yellow-100 text-yellow-700">Borrowed</span>
                {% elif u.status == 'Damaged' %}
                  <span class="px-2 py-1 rounded-lg text-xs bg-red-100 text-red-700">Damaged</span>
                {% else %}
                  <span class="px-2 py-1 rounded-lg text-xs bg-gray-200 text-gray-700">{{ u.status }}</span>
                {% endif %}
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      <!-- Pagination -->
      <div class="flex justify-center items-center gap-3 mt-6">
        <button id="prevPage" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg disabled:opacity-40 disabled:cursor-not-allowed">Previous</button>
        <span id="pageInfo" class="text-gray-700">Page 1</span>
        <button id="nextPage" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg disabled:opacity-40 disabled:cursor-not-allowed">Next</button>
      </div>
    </section>
  </main>

  <!-- Logout Confirmation Modal -->
  <div id="logoutModal" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center z-50">
    <div class="bg-white rounded-2xl shadow-2xl p-6 w-96 text-center">
      <i data-lucide="alert-triangle" class="w-12 h-12 text-yellow-500 mx-auto mb-3"></i>
      <h2 class="text-lg font-semibold text-blue-600 mb-2">Confirm Logout</h2>
      <p class="text-gray-600 mb-6">Are you sure you want to log out of your account?</p>
      <div class="flex justify-center space-x-3">
        <button id="cancelLogout" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg">Cancel</button>
        <form method="post" action="{{ url_for('login_bp.logout') }}">
          <button type="submit" id="confirmLogout" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg">Logout</button>
        </form>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script>
    lucide.createIcons();

    // Sidebar toggle
    const sidebar = document.getElementById('sidebar');
    const overlay = document.getElementById('overlay');
    const toggleBtn = document.getElementById('sidebarToggle');

    toggleBtn?.addEventListener('click', () => {
      sidebar.classList.toggle('-translate-x-full');
      overlay.classList.toggle('hidden');
    });

    overlay.addEventListener('click', () => {
      sidebar.classList.add('-translate-x-full');
      overlay.classList.add('hidden');
    });

    // Logout modal
    const logoutBtn = document.getElementById('logoutBtn');
    const logoutModal = document.getElementById('logoutModal');
    const cancelLogout = document.getElementById('cancelLogout');
    logoutBtn.addEventListener('click', () => logoutModal.classList.remove('hidden'));
    cancelLogout.addEventListener('click', () => logoutModal.classList.add('hidden'));

    // Search, Filter, Pagination
    const searchInput = document.getElementById("searchInput");
    const statusFilter = document.getElementById("statusFilter");
    const table = document.getElementById("inventoryTable").getElementsByTagName("tbody")[0];
    const rows = table.getElementsByTagName("tr");
    const rowsPerPage = 10;
    let currentPage = 1;

    function filterAndPaginate() {
      const searchText = searchInput.value.toLowerCase();
      const statusValue = statusFilter.value;

      let filteredRows = [];
      for (let row of rows) {
        const cells = row.getElementsByTagName("td");
        const itemText = cells[0].textContent.toLowerCase();
        const brandText = cells[1].textContent.toLowerCase();
        const serialText = cells[2].textContent.toLowerCase();
        const statusText = cells[3].textContent.trim();

        const matchesSearch =
          itemText.includes(searchText) ||
          brandText.includes(searchText) ||
          serialText.includes(searchText);

        const matchesStatus =
          statusValue === "all" || statusText.includes(statusValue);

        if (matchesSearch && matchesStatus) {
          filteredRows.push(row);
        }
      }

      const totalPages = Math.ceil(filteredRows.length / rowsPerPage);
      if (currentPage > totalPages) currentPage = totalPages || 1;

      for (let i = 0; i < rows.length; i++) {
        rows[i].style.display = "none";
      }

      const start = (currentPage - 1) * rowsPerPage;
      const end = start + rowsPerPage;
      for (let i = start; i < end && i < filteredRows.length; i++) {
        filteredRows[i].style.display = "";
      }

      document.getElementById("pageInfo").textContent = `Page ${currentPage} of ${totalPages || 1}`;
      document.getElementById("prevPage").disabled = currentPage === 1;
      document.getElementById("nextPage").disabled = currentPage === totalPages || totalPages === 0;
    }

    document.getElementById("prevPage").addEventListener("click", () => {
      if (currentPage > 1) {
        currentPage--;
        filterAndPaginate();
      }
    });

    document.getElementById("nextPage").addEventListener("click", () => {
      currentPage++;
      filterAndPaginate();
    });

    searchInput.addEventListener("input", () => {
      currentPage = 1;
      filterAndPaginate();
    });
    statusFilter.addEventListener("change", () => {
      currentPage = 1;
      filterAndPaginate();
    });

    // Initial load
    filterAndPaginate();
  </script>
</body>
</html>
